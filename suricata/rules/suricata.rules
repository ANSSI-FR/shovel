# Copyright (C) 2023-2024  ANSSI
# SPDX-License-Identifier: GPL-2.0-or-later
#
# Suricata rules for Attack-Defense CTF games
# Please remember to increment `sid` when adding new rules as its value must be unique.
# Make sure matching is done on at least 4 bytes to reduce false positives.

# Flags (sid 1-1000)
# As PCRE is slow, please use a content filter before.
# Please test your regex at https://regex101.com/ using "PCRE2" mode.
# Some rules match also in 'file.data' in case of compressed payload.
alert ip any any -> any any (msg: "A CINI flag (ECSC 2024) was sent to client"; flow:to_client; content: "="; pcre: "/(\d[A-Z0-9][0-2][A-Z0-9]{28}=)/, flow:match"; distance: -32; content:!"AAAAA="; distance: -6; metadata: tag FLAG OUT, color danger; sid: 1;)
alert ip any any -> any any (msg: "A CINI flag (ECSC 2024) was sent to client"; flow:to_client; file.data; content: "="; pcre: "/(\d[A-Z0-9][0-2][A-Z0-9]{28}=)/, flow:match"; distance: -32; content:!"AAAAA="; distance: -6; metadata: tag FLAG OUT, color danger; sid: 2;)
alert ip any any -> any any (msg: "A CINI flag (ECSC 2024) was sent to client (hex)"; flow:to_client; content: "3d"; pcre: "/(3[0-9][345][0-9a-f]3[0-2](?:[345][0-9a-f]){28}3d)/, flow:match"; distance: -64; metadata: tag FLAG OUT HEX, color danger; sid: 3;)
alert ip any any -> any any (msg: "A CINI flag (ECSC 2024) was sent to client (hex)"; flow:to_client; content: "3D"; pcre: "/(3[0-9][345][0-9A-F]3[0-2](?:[345][0-9A-F]){28}3D)/, flow:match"; distance: -64; metadata: tag FLAG OUT HEX, color danger; sid: 4;)
alert ip any any -> any any (msg: "A CINI flag (ECSC 2024) was sent to client (base64)"; flow:to_client; content: "0="; pcre: "/((?:[MNOQ-W][DEFjkl01TUVz][014589ABEFIJMNQRUVYZcdghklopstwx][0-5B-Zawxyz]){10}[MNOQ-W][jDzT]0=)/, flow:match"; distance: -44; metadata: tag FLAG OUT B64, color danger; sid: 5;)
alert ip any any -> any any (msg: "A CINI flag (ECSC 2024) was placed in our services (probably by checkers)"; flow:to_server; content: "="; pcre: "/(\d[A-Z0-9][0-2][A-Z0-9]{28}=)/, flow:match"; distance: -32; content:!"AAAAA="; distance: -6; metadata: tag FLAG IN, color success; sid: 6;)
alert ip any any -> any any (msg: "A ECSC flag was sent to client"; flow:to_client; content: "ECSC_"; pcre: "/(ECSC_[A-Za-z0-9\/+]{32})/, flow:match"; distance: -5; metadata: tag FLAG OUT, color danger; sid: 11;)
alert ip any any -> any any (msg: "A ECSC flag was sent to client"; flow:to_client; file.data; content: "ECSC_"; pcre: "/(ECSC_[A-Za-z0-9\/+]{32})/, flow:match"; distance: -5; metadata: tag FLAG OUT, color danger; sid: 12;)
alert ip any any -> any any (msg: "A ECSC flag was sent to client (base64)"; flow:to_client; content: "RUNTQ1"; pcre: "/(RUNTQ1[A-Za-z0-9\/+]{44}==)/, flow:match"; distance: -6; metadata: tag FLAG OUT B64, color danger; sid: 13;)
alert ip any any -> any any (msg: "A ECSC flag was sent to client (base64)"; flow:to_client; file.data; content: "RUNTQ1"; pcre: "/(RUNTQ1[A-Za-z0-9\/+]{44}==)/, flow:match"; distance: -6; metadata: tag FLAG OUT B64, color danger; sid: 14;)
alert ip any any -> any any (msg: "A ECSC flag was send to server (probably by checkers)"; flow:to_server; content: "ECSC_"; pcre: "/(ECSC_[A-Za-z0-9\/+]{32})/, flow:match"; distance: -5; metadata: tag FLAG IN, color success; sid: 15;)
alert ip any any -> any any (msg: "A ENOWARS flag was sent to client"; flow:to_client; content: "ENO"; pcre: "/(ENO[A-Za-z0-9+\/]{2}AAA[A-Za-z0-9+\/]{2}AAA[A-Za-z0-9+\/]{4}AA[A-Za-z0-9+\/]{3}AA[A-Za-z0-9+\/]{27})/, flow:match"; distance: -3; metadata: tag FLAG OUT, color danger; sid: 21;)
alert ip any any -> any any (msg: "A ENOWARS flag was sent to client"; flow:to_client; file.data; content: "ENO"; pcre: "/(ENO[A-Za-z0-9+\/]{2}AAA[A-Za-z0-9+\/]{2}AAA[A-Za-z0-9+\/]{4}AA[A-Za-z0-9+\/]{3}AA[A-Za-z0-9+\/]{27})/, flow:match"; distance: -3; metadata: tag FLAG OUT, color danger; sid: 22;)
alert ip any any -> any any (msg: "A ENOWARS flag was sent to client (base64)"; flow:to_client; content: "RU5P"; pcre: "/(RU5P[A-Za-z0-9]{3}BQU[A-Za-z0-9]{4}FBQ[A-Za-z0-9]{6}BQ[A-Za-z0-9]{5}FB[A-Za-z0-9]{36})/, flow:match"; distance: -4; metadata: tag FLAG OUT B64, color danger; sid: 23;)
alert ip any any -> any any (msg: "A ENOWARS flag was sent to client (base64)"; flow:to_client; file.data; content: "RU5P"; pcre: "/(RU5P[A-Za-z0-9]{3}BQU[A-Za-z0-9]{4}FBQ[A-Za-z0-9]{6}BQ[A-Za-z0-9]{5}FB[A-Za-z0-9]{36})/, flow:match"; distance: -4; metadata: tag FLAG OUT B64, color danger; sid: 24;)
alert ip any any -> any any (msg: "A ENOWARS flag was placed in our services (probably by checkers)"; flow:to_server; content: "ENO"; pcre: "/(ENO[A-Za-z0-9+\/]{2}AAA[A-Za-z0-9+\/]{2}AAA[A-Za-z0-9+\/]{4}AA[A-Za-z0-9+\/]{3}AA[A-Za-z0-9+\/]{27})/, flow:match"; distance: -3; metadata: tag FLAG IN, color success; sid: 25;)
alert ip any any -> any any (msg: "A FAUSTCTF flag was sent to client"; flow:to_client; content: "FAUST_"; pcre: "/(FAUST_[A-Za-z0-9\/+]{32})/, flow:match"; distance: -6; metadata: tag FLAG OUT, color danger; sid: 31;)
alert ip any any -> any any (msg: "A FAUSTCTF flag was sent to client"; flow:to_client; file.data; content: "FAUST_"; pcre: "/(FAUST_[A-Za-z0-9\/+]{32})/, flow:match"; distance: -6; metadata: tag FLAG OUT, color danger; sid: 32;)
alert ip any any -> any any (msg: "A FAUSTCTF flag was sent to client (base64)"; flow:to_client; content: "RkFVU1Rf"; pcre: "/(RkFVU1Rf[A-Za-z0-9\/+]{43}=)/, flow:match"; distance: -8; metadata: tag FLAG OUT B64, color danger; sid: 33;)
alert ip any any -> any any (msg: "A FAUSTCTF flag was sent to client (base64)"; flow:to_client; file.data; content: "RkFVU1Rf"; pcre: "/(RkFVU1Rf[A-Za-z0-9\/+]{43}=)/, flow:match"; distance: -8; metadata: tag FLAG OUT B64, color danger; sid: 34;)
alert ip any any -> any any (msg: "A FAUSTCTF flag was placed in our services (probably by checkers)"; flow:to_server; content: "FAUST_"; pcre: "/(FAUST_[A-Za-z0-9\/+]{32})/, flow:match"; distance: -6; metadata: tag FLAG IN, color success; sid: 35;)
alert ip any any -> any any (msg: "A ICC flag was sent to client"; flow:to_client; content: "ICC_"; pcre: "/(ICC_[A-Za-z0-9\/+]{32})/, flow:match"; distance: -4; metadata: tag FLAG OUT, color danger; sid: 41;)
alert ip any any -> any any (msg: "A ICC flag was sent to client"; flow:to_client; file.data; content: "ICC_"; pcre: "/(ICC_[A-Za-z0-9\/+]{32})/, flow:match"; distance: -4; metadata: tag FLAG OUT, color danger; sid: 42;)
alert ip any any -> any any (msg: "A ICC flag was sent to client (base64)"; flow:to_client; content: "SUNDX"; metadata: tag FLAG OUT B64, color danger; sid: 43;)
alert ip any any -> any any (msg: "A ICC flag was sent to client (base64)"; flow:to_client; file.data; content: "SUNDX"; metadata: tag FLAG OUT B64, color danger; sid: 44;)
alert ip any any -> any any (msg: "A ICC flag was placed in our services (probably by checkers)"; flow:to_server; content: "ICC_"; pcre: "/(ICC_[A-Za-z0-9\/+]{32})/, flow:match"; distance: -4; metadata: tag FLAG IN, color success; sid: 45;)
alert ip any any -> any any (msg: "A saarCTF flag was sent to client"; flow:to_client; content: "SAAR"; pcre: "/(SAAR\{[A-Za-z0-9-_]{32}\})/, flow:match"; distance: -4; metadata: tag FLAG OUT, color danger; sid: 51;)
alert ip any any -> any any (msg: "A saarCTF flag was sent to client"; flow:to_client; file.data; content: "SAAR{"; pcre: "/(SAAR\{[A-Za-z0-9-_]{32}\})/, flow:match"; distance: -5; metadata: tag FLAG OUT, color danger; sid: 52;)
alert ip any any -> any any (msg: "A saarCTF flag was sent to client (URL encoded)"; flow:to_client; content: "SAAR%7B"; pcre: "/(SAAR%7B[A-Za-z0-9-_]{32}%7D)/, flow:match"; distance: -7; metadata: tag FLAG OUT, color danger; sid: 53;)
alert ip any any -> any any (msg: "A saarCTF flag was sent to client (base64)"; flow:to_client; content: "U0FBUnt"; metadata: tag FLAG OUT B64, color danger; sid: 54;)
alert ip any any -> any any (msg: "A saarCTF flag was sent to client (base64)"; flow:to_client; content: "NBQVJ7"; pcre: "/(NBQVJ7[A-Za-z\d]{43}9)/, flow:match"; distance: -6; metadata: tag FLAG OUT B64, color danger; sid: 55;)
alert ip any any -> any any (msg: "A saarCTF flag was sent to client (base64)"; flow:to_client; content: "TQUFSe"; pcre: "/(TQUFSe[A-Za-z\d]{43}f)/, flow:match"; distance: -6; metadata: tag FLAG OUT B64, color danger; sid: 56;)
alert ip any any -> any any (msg: "A saarCTF flag was placed in our services (probably by checkers)"; flow:to_server; content: "SAAR"; pcre: "/(SAAR\{[A-Za-z0-9-_]{32}\})/, flow:match"; distance: -4; metadata: tag FLAG IN, color success; sid: 57;)
alert ip any any -> any any (msg: "A saarCTF flag was placed in our services (probably by checkers, URL encoded)"; flow:to_server; content: "SAAR%7B"; pcre: "/(SAAR%7B[A-Za-z0-9-_]{32}%7D)/, flow:match"; distance: -7; metadata: tag FLAG IN, color success; sid: 58;)

# Tag file formats using libmagic (sid 1001-2000)
# As libmagic calls are slow, please use a content filter before.
# fast_pattern overrides Suricata fast pattern determination.
alert ip any any -> any any (msg: "tag"; file.data; content: "|00|asm"; startswith; fast_pattern; filemagic: "WebAssembly (wasm) binary"; metadata: tag WASM, color primary; sid: 1001;)
alert ip any any -> any any (msg: "tag"; file.data; content: "|28 B5 2F FD|"; startswith; fast_pattern; filemagic: "Zstandard compressed data"; metadata: tag ZST, color primary; sid: 1002;)
alert ip any any -> any any (msg: "tag"; file.data; content: "|25|PDF-"; depth:10; fast_pattern; filemagic: "PDF document"; metadata: tag PDF, color primary; sid: 1003;)
alert ip any any -> any any (msg: "tag"; file.data; content: "|89|PNG|0d 0a|"; startswith; fast_pattern; filemagic: "PNG image"; metadata: tag PNG, color primary; sid: 1004;)
alert ip any any -> any any (msg: "tag"; file.data; content: "|FD|7zXZ|00|"; startswith; fast_pattern; filemagic: "XZ compressed data"; metadata: tag XZ, color primary; sid: 1005;)
alert ip any any -> any any (msg: "tag"; file.data; content: "|ff d8 ff|"; startswith; fast_pattern; filemagic: "JPEG image"; metadata: tag JPG, color primary; sid: 1006;)
alert ip any any -> any any (msg: "tag"; file.data; content: "7z|BC AF 27 1C|"; startswith; fast_pattern; filemagic: "7-zip archive data"; metadata: tag 7Z, color primary; sid: 1007;)
alert ip any any -> any any (msg: "tag"; file.data; content: "GIF"; startswith; fast_pattern; filemagic: "GIF image"; metadata: tag GIF, color primary; sid: 1008;)
alert ip any any -> any any (msg: "tag"; file.data; content: "MSCF|00 00 00 00|"; startswith; fast_pattern; filemagic: "Microsoft cabinet file data"; metadata: tag CAB, color primary; sid: 1009;)
alert ip any any -> any any (msg: "tag"; file.data; content: "MThd"; startswith; fast_pattern; filemagic: "Standard MIDI data"; metadata: tag MIDI, color primary; sid: 1010;)
alert ip any any -> any any (msg: "tag"; file.data; content: "PK|03 04|"; startswith; fast_pattern; filemagic: "Microsoft Excel 2007+"; metadata: tag XLSX, color primary; sid: 1011;)
alert ip any any -> any any (msg: "tag"; file.data; content: "PK|03 04|"; startswith; fast_pattern; filemagic: "Microsoft PowerPoint 2007+"; metadata: tag PPTX, color primary; sid: 1012;)
alert ip any any -> any any (msg: "tag"; file.data; content: "PK|03 04|"; startswith; fast_pattern; filemagic: "Microsoft Word 2007+"; metadata: tag DOCX, color primary; sid: 1013;)
alert ip any any -> any any (msg: "tag"; file.data; content: "PK|03 04|"; startswith; fast_pattern; filemagic: "Zip archive"; metadata: tag ZIP, color primary; sid: 1014;)
alert ip any any -> any any (msg: "tag"; file.data; content: "Vgm|20|"; startswith; fast_pattern; filemagic: "VGM Video Game Music"; metadata: tag VGM, color primary; sid: 1015;)
alert ip any any -> any any (msg: "tag"; file.data; content: "wOF"; startswith; fast_pattern; filemagic: "Web Open Font"; metadata: tag WOFF, color primary; sid: 1016;)
alert ip any any -> any any (msg: "tag"; file.data; content: "|7F|ELF|02 01 01 00 00 00 00 00 00 00 00 00|"; startswith; fast_pattern; filemagic: "ELF"; metadata: tag ELF, color primary; sid: 1017;)
alert ip any any -> any any (msg: "tag"; file.data; content: "f0VMRgIBAQAAAAAAAAAAAA"; metadata: tag ELF B64, color primary; sid: 1018;)
alert ip any any -> any any (msg: "tag"; file.data; content: "<html"; depth: 256; nocase; fast_pattern; filemagic: "HTML document"; metadata: tag HTML, color primary; sid: 1019;)

# Tag HTTP methods and status (sid 2001-3000)
alert http any any -> any any (msg: "tag"; http.method; content: "POST"; startswith; metadata: tag POST, color info; sid: 2001;)
alert http any any -> any any (msg: "tag"; http.method; content: "PUT"; startswith; metadata: tag PUT, color info; sid: 2002;)
alert http any any -> any any (msg: "tag"; http.method; content: "HEAD"; startswith; metadata: tag HEAD, color info; sid: 2003;)
alert http any any -> any any (msg: "tag"; http.method; content: "DELETE"; startswith; metadata: tag DELETE, color info; sid: 2004;)
alert http any any -> any any (msg: "tag"; http.method; content: "TRACE"; startswith; metadata: tag TRACE, color info; sid: 2005;)
alert http any any -> any any (msg: "tag"; http.method; content: "OPTIONS"; startswith; metadata: tag OPTIONS, color info; sid: 2006;)
alert http any any -> any any (msg: "tag"; http.method; content: "CONNECT"; startswith; metadata: tag CONNECT, color info; sid: 2007;)
alert http any any -> any any (msg: "tag"; http.method; content: "PATCH"; startswith; metadata: tag PATCH, color info; sid: 2008;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "101"; startswith; metadata: tag 101, color info; sid: 2101;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "201"; startswith; metadata: tag 201, color info; sid: 2102;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "202"; startswith; metadata: tag 202, color info; sid: 2103;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "204"; startswith; metadata: tag 204, color info; sid: 2104;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "301"; startswith; metadata: tag 301, color info; sid: 2105;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "302"; startswith; metadata: tag 302, color info; sid: 2106;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "303"; startswith; metadata: tag 303, color info; sid: 2107;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "304"; startswith; metadata: tag 304, color info; sid: 2108;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "400"; startswith; metadata: tag 400, color info; sid: 2109;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "401"; startswith; metadata: tag 401, color info; sid: 2110;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "403"; startswith; metadata: tag 403, color info; sid: 2111;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "404"; startswith; metadata: tag 404, color info; sid: 2112;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "405"; startswith; metadata: tag 405, color info; sid: 2113;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "408"; startswith; metadata: tag 408, color info; sid: 2114;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "500"; startswith; metadata: tag 500, color info; sid: 2115;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "501"; startswith; metadata: tag 501, color info; sid: 2116;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "502"; startswith; metadata: tag 502, color info; sid: 2117;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "503"; startswith; metadata: tag 503, color info; sid: 2118;)
alert http any any -> any any (msg: "tag"; http.stat_code; content: "504"; startswith; metadata: tag 504, color info; sid: 2119;)

# Identify user agents and some common response messages (sid 3001-4000)
alert http any any -> any any (msg: "tag"; flow:to_server; content: "python-requests/"; startswith; http_user_agent; metadata: tag UA PyReq, color info; sid: 3001;)
alert http any any -> any any (msg: "tag"; flow:to_server; content: "python-httpx/"; startswith; http_user_agent; metadata: tag UA HTTPX, color info; sid: 3002;)
alert http any any -> any any (msg: "tag"; flow:to_server; content: "HeadlessChrome/"; http_user_agent; metadata: tag UA HLChrome, color info; sid: 3003;)
alert http any any -> any any (msg: "tag"; flow:to_server; content: "Gecko/20100101 Firefox/"; http_user_agent; metadata: tag UA Firefox, color info; sid: 3004;)
alert http any any -> any any (msg: "tag"; flow:to_server; content: "AppleWebKit/537.36 (KHTML, like Gecko) Chrome/"; http_user_agent; metadata: tag UA Chrome, color info; sid: 3005;)
alert http any any -> any any (msg: "tag"; flow:to_server; content: "AppleWebKit/"; content: " (KHTML, like Gecko) Version/"; distance: 0; content: " Safari/"; distance: 0; http_user_agent; metadata: tag UA Safari, color info; sid: 3006;)
alert http any any -> any any (msg: "tag"; flow:to_server; content: "Mozilla/4.0 (compatible|3B| MSIE 9.0|3B| Windows "; startswith; http_user_agent; metadata: tag UA IE, color info; sid: 3007;)
alert http any any -> any any (msg: "tag"; flow:to_server; content: "nushell"; startswith; http_user_agent; metadata: tag UA NUSHELL, color info; sid: 3008;)
alert http any any -> any any (msg: "tag"; flow:to_server; content: "Python/3."; startswith; http_user_agent; metadata: tag UA Py, color info; sid: 3009;)
alert http any any -> any any (msg: "tag"; flow:to_server; content: "python-urllib3/"; startswith; http_user_agent; metadata: tag UA URLLIB3, color info; sid: 3010;)
alert http any any -> any any (msg: "tag"; flow:to_server; content: "curl/"; startswith; http_user_agent; metadata: tag UA CURL, color info; sid: 3011;)
alert http any any -> any any (msg: "tag"; flow:to_server; content: "Go-http-client/"; startswith; http_user_agent; metadata: tag UA Go, color info; sid: 3012;)

# Common exploit payloads (sid 4001-5000)
# content can not use doublequote, ;, : and |, see https://docs.suricata.io/en/suricata-7.0.6/rules/payload-keywords.html
rejectboth ip any any -> any any (msg: "Found Bash space bypass '${IFS}'"; flow:to_server; content: "${IFS}"; metadata: tag BASH ${IFS}, color warning; sid: 4001;)
rejectboth ip any any -> any any (msg: "Found Bash space bypass '${IFS}' (URL encoded)"; flow:to_server; content: "%24%7BIFS%7D"; metadata: tag BASH ${IFS}, color warning; sid: 4002;)
rejectboth ip any any -> any any (msg: "Found Bash space bypass '$IFS'"; flow:to_server; content: "$IFS"; pcre: "/[\t-~]{5}/"; distance: 0; metadata: tag BASH $IFS, color warning; sid: 4003;)
rejectboth ip any any -> any any (msg: "Found Bash space bypass '$IFS' (URL encoded)"; flow:to_server; content: "%24IFS"; pcre: "/[\t-~]{5}/"; distance: 0; metadata: tag BASH $IFS, color warning; sid: 4004;)
rejectboth ip any any -> any any (msg: "Found LaTeX '\\include{'"; flow:to_server; content: "|5c|include|7b|"; metadata: tag LATEX INC, color warning; sid: 4051;)
rejectboth ip any any -> any any (msg: "Found LaTeX '\\input{'"; flow:to_server; content: "|5c|input|7b|"; metadata: tag LATEX INPUT, color warning; sid: 4052;)
rejectboth ip any any -> any any (msg: "Found LaTeX '\\lstinputlisting{'"; flow:to_server; content: "|5c|lstinputlisting|7b|"; metadata: tag LATEX LST, color warning; sid: 4053;)
rejectboth ip any any -> any any (msg: "Found LaTeX '\\read\\file'"; flow:to_server; content: "|5c|read|5c|file"; metadata: tag LATEX READ, color warning; sid: 4054;)
rejectboth ip any any -> any any (msg: "Found LaTeX '\\verbatiminput{'"; flow:to_server; content: "|5c|verbatiminput|7b|"; metadata: tag LATEX VERB, color warning; sid: 4055;)
rejectboth ip any any -> any any (msg: "Found LaTeX '\\write\\outfile'"; flow:to_server; content: "|5c|write|5c|outfile"; metadata: tag LATEX WRITE, color warning; sid: 4056;)
rejectboth ip any any -> any any (msg: "Found LDAP 'commonName='"; flow:to_server; content: "commonName="; metadata: tag LDAP FIELD, color warning; sid: 4101;)
rejectboth ip any any -> any any (msg: "Found LDAP 'givenName='"; flow:to_server; content: "givenName="; metadata: tag LDAP FIELD, color warning; sid: 4102;)
rejectboth ip any any -> any any (msg: "Found LDAP 'objectClass='"; flow:to_server; content: "objectClass="; metadata: tag LDAP FIELD, color warning; sid: 4103;)
rejectboth ip any any -> any any (msg: "Found LDAP 'userPassword='"; flow:to_server; content: "userPassword="; metadata: tag LDAP FIELD, color warning; sid: 4104;)
rejectboth ip any any -> any any (msg: "Found NodeJS serialized function '_$$ND_FUNC$$_'"; flow:to_server; content: "_$$ND_FUNC$$_"; nocase; metadata: tag NODEJS NDFUNC, color warning; sid: 4151;)
rejectboth ip any any -> any any (msg: "Found path '/dev/tcp/'"; flow:to_server; content: "/dev/tcp/"; metadata: tag /dev/tcp/, color warning; sid: 4201;)
rejectboth ip any any -> any any (msg: "Found path '/dev/tcp/' (URL encoded)"; flow:to_server; content: "%2Fdev%2Ftcp"; metadata: tag /dev/tcp/, color warning; sid: 4202;)
rejectboth ip any any -> any any (msg: "Found path '/etc/passwd'"; flow:to_server; content: "/etc/passwd"; metadata: tag /etc/passwd, color warning; sid: 4203;)
rejectboth ip any any -> any any (msg: "Found path '/etc/passwd' (URL encoded)"; flow:to_server; content: "%2Fetc%2Fpasswd"; metadata: tag /etc/passwd, color warning; sid: 4204;)
rejectboth ip any any -> any any (msg: "Found path '/var/lib/'"; flow:to_server; content: "/var/lib/"; metadata: tag /var/lib/, color warning; sid: 4205;)
rejectboth ip any any -> any any (msg: "Found path '/var/lib/' (URL encoded)"; flow:to_server; content: "%2Fvar%2Flib%2F"; metadata: tag /var/lib/, color warning; sid: 4206;)
rejectboth ip any any -> any any (msg: "Found path '/var/log/'"; flow:to_server; content: "/var/log/"; metadata: tag /var/log/, color warning; sid: 4207;)
rejectboth ip any any -> any any (msg: "Found path '/var/log/ (URL encoded)'"; flow:to_server; content: "%2Fvar%2Flog%2F"; metadata: tag /var/log/, color warning; sid: 4208;)
rejectboth ip any any -> any any (msg: "Found path '/bin/nc'"; flow:to_server; content: "/bin/nc"; metadata: tag /bin/nc, color warning; sid: 4209;)
rejectboth ip any any -> any any (msg: "Found path '/bin/nc' (URL encoded)"; flow:to_server; content: "%2Fbin%2Fnc"; metadata: tag /bin/nc, color warning; sid: 4210;)
rejectboth ip any any -> any any (msg: "Found path '/bin/sh'"; flow:to_server; content: "/bin/sh"; metadata: tag /bin/sh, color warning; sid: 4211;)
rejectboth ip any any -> any any (msg: "Found path '/bin/sh' (URL encoded)"; flow:to_server; content: "%2Fbin%2Fsh"; metadata: tag /bin/sh, color warning; sid: 4212;)
rejectboth ip any any -> any any (msg: "Found path '/bin/bash'"; flow:to_server; content: "/bin/bash"; metadata: tag /bin/bash, color warning; sid: 4213;)
rejectboth ip any any -> any any (msg: "Found path '/bin/bash' (URL encoded)"; flow:to_server; content: "%2Fbin%2Fbash"; metadata: tag /bin/bash, color warning; sid: 4214;)
rejectboth ip any any -> any any (msg: "Found path 'file://'"; flow:to_server; content: "file|3A|//"; nocase; metadata: tag file://, color warning; sid: 4215;)
rejectboth ip any any -> any any (msg: "Found path 'file://' (URL encoded)"; flow:to_server; content: "file%3A%2F%2F"; nocase; metadata: tag file://, color warning; sid: 4216;)
rejectboth ip any any -> any any (msg: "Found path 'gopher://'"; flow:to_server; content: "gopher|3A|//"; nocase; metadata: tag gopher://, color warning; sid: 4217;)
rejectboth ip any any -> any any (msg: "Found path 'gopher://' (URL encoded)"; flow:to_server; content: "gopher%3A%2F%2F"; nocase; metadata: tag gopher://, color warning; sid: 4218;)
rejectboth ip any any -> any any (msg: "Found path 'ldap://'"; flow:to_server; content: "ldap|3A|//"; nocase; metadata: tag ldap://, color warning; sid: 4219;)
rejectboth ip any any -> any any (msg: "Found path 'ldap://' (URL encoded)"; flow:to_server; content: "ldap%3A%2F%2F"; nocase; metadata: tag ldap://, color warning; sid: 4220;)
rejectboth ip any any -> any any (msg: "Found path 'phar://'"; flow:to_server; content: "phar|3A|//"; nocase; metadata: tag phar://, color warning; sid: 4221;)
rejectboth ip any any -> any any (msg: "Found path 'phar://' (URL encoded)"; flow:to_server; content: "phar%3A%2F%2F"; nocase; metadata: tag phar://, color warning; sid: 4222;)
rejectboth ip any any -> any any (msg: "Found path 'php://'"; flow:to_server; content: "php|3A|//"; nocase; metadata: tag php://, color warning; sid: 4223;)
rejectboth ip any any -> any any (msg: "Found path 'php://' (URL encoded)"; flow:to_server; content: "php%3A%2F%2F"; nocase; metadata: tag php://, color warning; sid: 4224;)
rejectboth ip any any -> any any (msg: "Found path 'tftp://'"; flow:to_server; content: "tftp|3A|//"; nocase; metadata: tag tftp://, color warning; sid: 4225;)
rejectboth ip any any -> any any (msg: "Found path 'tftp://' (URL encoded)"; flow:to_server; content: "tftp%3A%2F%2F"; nocase; metadata: tag tftp://, color warning; sid: 4226;)
rejectboth ip any any -> any any (msg: "Found path 'zip://'"; flow:to_server; content: "zip|3A|//"; nocase; metadata: tag zip://, color warning; sid: 4227;)
rejectboth ip any any -> any any (msg: "Found path 'zip://' (URL encoded)"; flow:to_server; content: "zip%3A%2F%2F"; nocase; metadata: tag zip://, color warning; sid: 4228;)
rejectboth ip any any -> any any (msg: "Found path traversal '../../' (URL encoded)"; flow:to_server; content: "..%2F..%2F"; metadata: tag Path Traversal, color warning; sid: 4229;)
rejectboth ip any any -> any any (msg: "Found Java '${jndi:'"; flow:to_server; content: "${jndi:"; metadata: tag JAVA JNDI, color warning; sid: 4251;)
rejectboth ip any any -> any any (msg: "Found PHP '<?php' opening tag"; flow:to_server; content: "<?php"; nocase; metadata: tag <?php, color warning; sid: 4301;)
rejectboth ip any any -> any any (msg: "Found PHP '$_FILES'"; flow:to_server; content: "$_FILES"; metadata: tag PHP $_FILES, color warning; sid: 4302;)
rejectboth ip any any -> any any (msg: "Found PHP '$_GET'"; flow:to_server; content: "$_GET"; metadata: tag PHP $_GET, color warning; sid: 4303;)
rejectboth ip any any -> any any (msg: "Found PHP '$_POST'"; flow:to_server; content: "$_POST"; metadata: tag PHP $_POST, color warning; sid: 4304;)
rejectboth ip any any -> any any (msg: "Found PHP 'echo system'"; flow:to_server; content: "echo system"; nocase; metadata: tag PHP system(), color warning; sid: 4305;)
rejectboth ip any any -> any any (msg: "Found PHP 'file_get_contents' call"; flow:to_server; content: "file_get_contents"; nocase; metadata: tag PHP f_g_c(), color warning; sid: 4306;)
rejectboth ip any any -> any any (msg: "Found PHP 'halt_compiler' call"; flow:to_server; content: "halt_compiler"; nocase; metadata: tag PHP h_c(), color warning; sid: 4307;)
alert ip any any -> any any (msg: "Found SQL 'SELECT . FROM '"; flow:to_server; content: "SELECT "; nocase; content: " FROM "; nocase; within: 256; metadata: tag SQL SELECT, color warning; sid: 4351;)
rejectboth ip any any -> any any (msg: "Found SQL 'SELECT . FROM ' (URL encoded)"; flow:to_server; content: "SELECT+"; nocase; content: "+FROM+"; nocase; within: 256; metadata: tag SQL SELECT, color warning; sid: 4352;)
rejectboth ip any any -> any any (msg: "Found SQL 'array_to_string'"; flow:to_server; content: "array_to_string"; nocase; metadata: tag SQL A2S, color warning; sid: 4353;)
rejectboth ip any any -> any any (msg: "Found SQL 'regexp_count'"; flow:to_server; content: "regexp_count"; nocase; metadata: tag SQL REGC, color warning; sid: 4354;)
alert ip any any -> any any (msg: "Found SQL ' LIMIT 1'"; flow:to_server; content: " LIMIT 1"; nocase; metadata: tag SQL LIM1, color warning; sid: 4355;)
rejectboth ip any any -> any any (msg: "Found SQL ' LIMIT 1' (URL encoded)"; flow:to_server; content: "+LIMIT+1"; nocase; metadata: tag SQL LIM1, color warning; sid: 4356;)
rejectboth ip any any -> any any (msg: "Found SQL '::bytea'"; flow:to_server; content: "|3A 3A|bytea"; nocase; metadata: tag SQL BYTEA, color warning; sid: 4357;)
rejectboth ip any any -> any any (msg: "Found SQL 'CAST(. as bytea)'"; flow:to_server; content: "CAST("; content: " as bytea)"; nocase; metadata: tag SQL CAST, color warning; sid: 4358;)
rejectboth ip any any -> any any (msg: "Found SQL 'COALESCE('"; flow:to_server; content: "COALESCE("; nocase; metadata: tag SQL COALESCE, color warning; sid: 4359;)
rejectboth ip any any -> any any (msg: "Found SQL 'VARCHAR('"; flow:to_server; content: "VARCHAR("; nocase; metadata: tag SQL VARCHAR, color warning; sid: 4360;)
rejectboth ip any any -> any any (msg: "Found XML '<!ENTITY'"; flow:to_server; content: "|3C|!ENTITY"; nocase; metadata: tag <!ENTITY, color warning; sid: 4501;)
rejectboth ip any any -> any any (msg: "Found XML '<!ENTITY' (URL encoded)"; flow:to_server; content: "|25|3C|25|21ENTITY"; nocase; metadata: tag <!ENTITY, color warning; sid: 4502;)
rejectboth ip any any -> any any (msg: "Found XML '<!ENTITY' (URL encoded variant)"; flow:to_server; content: "|25|3C|21|ENTITY"; nocase; metadata: tag <!ENTITY, color warning; sid: 4503;)
rejectboth ip any any -> any any (msg: "Found XML '<!ENTITY' (base64)"; flow:to_server; content: "PCFFTlRJVF"; nocase; metadata: tag <!ENTITY, color warning; sid: 4504;)
rejectboth ip any any -> any any (msg: "Found XML '<!ENTITY' (base64)"; flow:to_server; content: "whRU5USVR"; nocase; metadata: tag <!ENTITY, color warning; sid: 4505;)
rejectboth ip any any -> any any (msg: "Found XML '<!ENTITY' (base64)"; flow:to_server; content: "8IUVOVElUW"; nocase; metadata: tag <!ENTITY, color warning; sid: 4506;)

# Common indicators, but might cause false positives
alert ip any any -> any any (msg: "tag"; flow:established,to_server; flow.age:>10; flowbits: isnotset, slowflow; flowbits: set, slowflow; metadata: tag Slow, color warning; sid: 5001;)
alert ip any any -> any any (msg: "Found TCP RST"; flow:to_server; flags: R+; metadata: tag RST, color warning; sid: 5002;)
alert ip any any -> any any (msg: "Found path '/bin/'"; flow:to_server; content: "/bin/"; metadata: tag /bin/, color warning; sid: 5101;)
alert ip any any -> any any (msg: "Found path '/bin/' (URL encoded)"; flow:to_server; content: "%2Fbin%2F"; metadata: tag /bin/, color warning; sid: 5102;)
alert ip any any -> any any (msg: "Found path '/etc/'"; flow:to_server; content: "/etc/"; metadata: tag /etc/, color warning; sid: 5103;)
alert ip any any -> any any (msg: "Found path '/etc/' (URL encoded)"; flow:to_server; content: "%2Fetc%2F"; metadata: tag /etc/, color warning; sid: 5104;)
alert ip any any -> any any (msg: "Found path '/proc/'"; flow:to_server; content: "/proc/"; metadata: tag /proc/, color warning; sid: 5105;)
alert ip any any -> any any (msg: "Found path '/proc/' (URL encoded)"; flow:to_server; content: "%2Fproc%2F"; metadata: tag /proc/, color warning; sid: 5106;)
alert ip any any -> any any (msg: "Found path '/tmp/'"; flow:to_server; content: "/tmp/"; metadata: tag /tmp/, color warning; sid: 5107;)
alert ip any any -> any any (msg: "Found path '/tmp/' (URL encoded)"; flow:to_server; content: "%2Ftmp%2F"; metadata: tag /tmp/, color warning; sid: 5108;)
alert ip any any -> any any (msg: "Found path traversal '../../'"; flow:to_server; content: "../../"; metadata: tag ../../, color warning; sid: 5109;)
alert ip any any -> any any (msg: "Found Unicode escape '\\u00..'"; flow:to_server; content: "|5C|u00"; pcre: "/[0-9a-fA-F]{2}/"; distance: 0; metadata: tag Unicode, color warning; sid: 5201;)

# Dissection anomalies
alert http any any -> any any (msg:"HTTP missing Host header"; flow:established,to_server; app-layer-event:http.missing_host_header; metadata: tag HTTP No Host, color warning; sid:6001;)
